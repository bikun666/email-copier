<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éù„Ç±„É¢„É≥Âª∫Âè∑JSÁîüÊàêÂô®</title>
    <style>
        * {
            box-sizing: border-box;
        }
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            background: linear-gradient(to right, #ff6e7f, #bfe9ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        input[type="file"] {
            margin-bottom: 1rem;
            padding: 0.5rem;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            background: #fff;
            color: #333;
        }
        button {
            padding: 0.7rem 2rem;
            font-size: 1.1rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6ec4, #7873f5);
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            margin: 0.5rem;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2);
        }
        .log {
            margin-top: 2rem;
            max-height: 200px;
            overflow: auto;
            width: 100%;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 10px;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        @media (max-width: 600px) {
            h1 {
                font-size: 1.5rem;
            }
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1>üî• „Éù„Ç±„É¢„É≥Âª∫Âè∑ JS Ë∂ÖÁ∫ßÁîüÊàêÂô®</h1>
    <input type="file" id="xlsxFile" accept=".xlsx">
    <button onclick="handleGenerate()">‚ú® ÁîüÊàê new.js</button>
    <div class="log" id="log"></div>

    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        let globalUserData = [];

        const log = (msg) => {
            document.getElementById('log').innerText += msg + '\n';
        };

        function addressChange(address) {
            const toFullWidthNumber = (num) => num.replace(/[0-9]/g, d => String.fromCharCode(d.charCodeAt(0) + 0xFF10 - 0x30));
            const toKanjiNumber = (num) => {
                const kanjiDigits = ['„Äá','‰∏Ä','‰∫å','‰∏â','Âõõ','‰∫î','ÂÖ≠','‰∏É','ÂÖ´','‰πù'];
                const n = parseInt(num, 10);
                if (isNaN(n)) return num;
                if (n <= 10) return kanjiDigits[n];
                return num.split('').map(d => kanjiDigits[parseInt(d)]).join('');
            };

            const [chome, ban, go] = address.split(/[-„Éº‚àí]/);
            if ([chome, ban, go].includes(undefined)) return address;

            const chomeVariants = [
                chome + "‰∏ÅÁõÆ",
                toFullWidthNumber(chome) + "„Å°„Çá„ÅÜ„ÇÅ",
                toFullWidthNumber(chome) + "„ÉÅ„Éß„Ç¶„É°",
                toKanjiNumber(chome) + "‰∏ÅÁõÆ"
            ];
            const banVariants = [
                ban + "Áï™",
                toFullWidthNumber(ban) + "„Å∞„Çì",
                toFullWidthNumber(ban) + "„Éê„É≥",
                toKanjiNumber(ban) + "Áï™"
            ];
            const goVariants = [
                go + "Âè∑",
                toFullWidthNumber(go) + "„Åî„ÅÜ",
                toFullWidthNumber(go) + "„Ç¥„Ç¶",
                toKanjiNumber(go) + "Âè∑"
            ];

            while (true) {
                const chomeStr = chomeVariants[Math.floor(Math.random() * chomeVariants.length)];
                const banStr = banVariants[Math.floor(Math.random() * banVariants.length)];
                const goStr = goVariants[Math.floor(Math.random() * goVariants.length)];
                const useDash1 = Math.random() < 0.5;
                const useDash2 = Math.random() < 0.5;
                if (useDash1 && banStr === "‰∏ÄÁï™") continue;
                if (useDash2 && goStr === "‰∏ÄÂè∑") continue;
                return chomeStr + (useDash1 ? '-' : '') + banStr + (useDash2 ? '-' : '') + goStr;
            }
        }

        function generatePhone() {
            const prefix = ['070', '080', '090'][Math.floor(Math.random() * 3)];
            return prefix + Array.from({length: 8}, () => Math.floor(Math.random() * 10)).join('');
        }

        function randomStr(len) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
            return Array.from({length: len}, () => chars[Math.floor(Math.random() * chars.length)]).join('');
        }

        async function handleGenerate() {
            const fileInput = document.getElementById('xlsxFile');
            if (!fileInput.files.length) return alert('ËØ∑ÂÖà‰∏ä‰º†xlsxÊñá‰ª∂');
            const file = fileInput.files[0];
            const data = await file.arrayBuffer();
            const workbook = XLSX.read(data);
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const json = XLSX.utils.sheet_to_json(sheet);
            log(`ËØªÂèñ ${json.length} Ë°åÊï∞ÊçÆ`);

            globalUserData = json.map(row => ({
                email: row.email,
                rowpassword: row.rowpassword || 'Abc1234.',
                name: row.name,
                kana: row.kana,
                phone: row.phone || generatePhone(),
                birthday: row.birthday,
                postal: row.postal,
                myAddress1: row.myAddress1,
                myAddress2: row.myAddress2,
                gender: row.gender
            }));

            for (const user of globalUserData) {
                user.nickname = randomStr(5);
                user.addressFull = addressChange(user.myAddress1) + ' ' + user.myAddress2;
            }

            const demoUrl = './demo.js';
            const resp = await fetch(demoUrl);
            let jsText = await resp.text();

            jsText = jsText.replace(
                /\/\/ USERDATA_PLACEHOLDER[^\n]*\nconst userData = \[[\s\S]*?\];/,
                '// USERDATA_PLACEHOLDER\nconst userData = ' + JSON.stringify(globalUserData, null, 4) + ';'
            );

            const blob = new Blob([jsText], {type: 'application/javascript'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'new.js';
            a.click();
        }
    </script>
</body>
</html>