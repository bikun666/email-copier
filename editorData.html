<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ğŸ”¥ è¶…çº§æ— æ•Œé…·ç‚« Demo.js ç”Ÿæˆå™¨</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top left, #0f2027, #203a43, #2c5364);
      color: #fff;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 20px;
      text-shadow: 0 0 10px #00f2ff;
    }
    input[type="file"] {
      display: none;
    }
    label.upload-btn {
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      padding: 12px 25px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1.1rem;
      box-shadow: 0 0 15px rgba(0,198,255,0.5);
      margin-bottom: 15px;
      transition: transform 0.2s;
    }
    label.upload-btn:hover {
      transform: scale(1.05);
    }
    button {
      background: linear-gradient(135deg, #fc466b, #3f5efb);
      border: none;
      color: #fff;
      padding: 12px 30px;
      font-size: 1.1rem;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(252, 70, 107, 0.5);
      transition: transform 0.2s;
    }
    button:hover {
      transform: scale(1.05);
    }
    @media (max-width: 600px) {
      h1 {
        font-size: 1.5rem;
      }
      button, label.upload-btn {
        font-size: 1rem;
        padding: 10px 20px;
      }
    }
  </style>
</head>
<body>
  <h1>âœ¨ Demo.js è¶…çº§ç”Ÿæˆå™¨</h1>
  <label class="upload-btn">
    ğŸ“ ä¸Šä¼  Excel æ–‡ä»¶
    <input type="file" id="xlsxInput" accept=".xlsx">
  </label>
  <button id="generateBtn">ğŸš€ ç”Ÿæˆå¹¶ä¸‹è½½ new.js</button>

  <script>
    const addressChange = (address) => {
      const toFullWidthNumber = num => num.replace(/[0-9]/g, d => String.fromCharCode(d.charCodeAt(0) + 0xFF10 - 0x30));
      const toKanjiNumber = num => {
        const kanjiDigits = ['ã€‡','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'];
        const n = parseInt(num, 10);
        if (isNaN(n)) return num;
        if (n <= 10) return kanjiDigits[n];
        return num.split('').map(d => kanjiDigits[parseInt(d)]).join('');
      };
      const [chome, ban, go] = address.split(/[-ãƒ¼âˆ’]/);
      if ([chome, ban, go].includes(undefined)) return address;
      const chomeVariants = [ chome + "ä¸ç›®", toFullWidthNumber(chome) + "ã¡ã‚‡ã†ã‚", toKanjiNumber(chome) + "ä¸ç›®" ];
      const banVariants = [ ban + "ç•ª", toFullWidthNumber(ban) + "ã°ã‚“", toKanjiNumber(ban) + "ç•ª" ];
      const goVariants = [ go + "å·", toFullWidthNumber(go) + "ã”ã†", toKanjiNumber(go) + "å·" ];
      while (true) {
        const c = chomeVariants[Math.floor(Math.random() * chomeVariants.length)];
        const b = banVariants[Math.floor(Math.random() * banVariants.length)];
        const g = goVariants[Math.floor(Math.random() * goVariants.length)];
        if (b === "ä¸€ç•ª" && Math.random() < 0.5) continue;
        if (g === "ä¸€å·" && Math.random() < 0.5) continue;
        return `${c}-${b}-${g}`;
      }
    };

    const generateRandomPhone = () => {
      const prefix = ['070', '080', '090'][Math.floor(Math.random() * 3)];
      return prefix + Array.from({ length: 8 }, () => Math.floor(Math.random() * 10)).join('');
    };

    const generateRandomString = (len) => {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
      return Array.from({ length: len }, () => chars[Math.floor(Math.random() * chars.length)]).join('');
    };

    const downloadJS = (jsText) => {
      try {
        const blob = new Blob([jsText], { type: 'application/javascript' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'new.js';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        console.log('âœ… new.js ä¸‹è½½æˆåŠŸ');
      } catch (e) {
        alert('âŒ ä¸‹è½½å¤±è´¥ï¼š' + e.message);
      }
    };

    document.getElementById('generateBtn').addEventListener('click', () => {
      const input = document.getElementById('xlsxInput');
      if (!input.files.length) {
        alert("è¯·å…ˆä¸Šä¼  xlsx æ–‡ä»¶");
        return;
      }
      const reader = new FileReader();
      reader.onload = function (e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(sheet);

        const processed = rows.map(row => {
          return {
            email: row.email || "",
            rowpassword: row.rowpassword || "Abc1234.",
            name: row.name || "",
            kana: row.kana || "",
            phone: row.phone || generateRandomPhone(),
            birthday: row.birthday || "19900101",
            postal: row.postal || "100-0001",
            myAddress1: row.myAddress1 || "1-1-1",
            myAddress2: row.myAddress2 || "è‡ªå‹•ç”Ÿæˆéƒ¨å±‹101",
            gender: row.gender || "9"
          };
        });

        const userDataJSON = JSON.stringify(processed, null, 2);
        fetch("demo.js")
          .then(res => res.text())
          .then(text => {
            const replaced = text.replace(/const userData = \[\s*\/\/ USERDATA_PLACEHOLDER[\s\S]*?\];/, `const userData = ${userDataJSON};`);
            downloadJS(replaced);
          })
          .catch(err => alert("âŒ åŠ è½½ demo.js å¤±è´¥: " + err));
      };
      reader.readAsArrayBuffer(input.files[0]);
    });
  </script>
</body>
</html>