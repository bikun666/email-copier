<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel æ•°æ®è½¬ä¸º UserData</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            padding: 20px;
        }
        #userDataDisplay {
            margin-top: 20px;
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            white-space: pre-wrap; /* ä¿æŒæ ¼å¼ */
            font-size: 14px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>

    <h1>Excel æ•°æ®è½¬ä¸º JavaScript æ•°ç»„å¹¶æ›¿æ¢æ²¹çŒ´è„šæœ¬</h1>

    <input type="file" id="file-input" accept=".xlsx" />
    <button onclick="copyToClipboard()">å¤åˆ¶æ²¹çŒ´è„šæœ¬</button>

    <div id="userDataDisplay"></div>

    <script>
        function handleFile(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = e.target.result;
                const workbook = XLSX.read(data, {type: 'binary'});
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]]; // åªé€‰æ‹©ç¬¬ä¸€ä¸ªsheet
                const jsonData = XLSX.utils.sheet_to_json(firstSheet); // å°†ç¬¬ä¸€ä¸ªsheetè½¬ä¸ºJSONæ•°æ®
                processData(jsonData);
            };
            reader.readAsBinaryString(file);
        }

        function processData(data) {
            const userData = data.map(row => {
                // å¦‚æœ email ä¸ºç©ºï¼Œåˆ™è·³è¿‡è¿™ä¸€è¡Œ
                if (!row["email"]) return null;

                return `{"email": "${row["email"] || ""}", "rowpassword": "${row["rowpassword"] || "Abc1234."}", "name": "${row["name"] || ""}", "kana": "${row["kana"] || ""}", "phone": "${row["phone"] || ""}", "birthday": "${row["birthday"] || ""}", "postal": "${row["postal"] || ""}", "myAddress1": "${row["myAddress1"] || ""}", "myAddress2": "${row["myAddress2"] || ""}", "gender": "${row["gender"] || "ã©ã¡ã‚‰ã‚‚é¸ã°ãªã„"}"}`;
            }).filter(row => row !== null);  // è¿‡æ»¤æ‰ email ä¸ºç©ºçš„è¡Œ

            displayUserData(userData);
        }
 
        function displayUserData(userData) {
            const userDataDisplay = document.getElementById('userDataDisplay');
            const updatedScript = generateUpdatedScript(userData);
            userDataDisplay.innerHTML = `<pre>${updatedScript}</pre>`;
        }

        function generateUpdatedScript(userData) {
            const scriptTemplate =  `// ==UserScript==
// @name kunãƒã‚±ãƒ¢ãƒ³ã‚»ãƒ³ã‚¿ãƒ¼ä¼šå“¡ç™»éŒ²è‡ªå‹•åŒ–åŠ©æ‰‹ (æ¥å•) - å®Œæ•´å¢å¼ºç‰ˆ
// @namespace http://tampermonkey.net/
// @version 3.6
// @description è‡ªåŠ¨å¡«å†™ä¼šå‘˜ç™»å½•è¡¨å• - å¢å¼ºç‰ˆï¼ˆæ‰€æœ‰æŒ‰é’®éƒ½åœ¨å·¦ä¾§ï¼‰
// @author CHEN BIKUN
// @match *://www.pokemoncenter-online.com/new-customer/*
// @grant none
// ==/UserScript==

(function() {
    'use strict';

    console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] ğŸš€ è„šæœ¬å¯åŠ¨ (å®Œæ•´å¢å¼ºç‰ˆ v3.6)');

    // ç”¨æˆ·æ•°æ®
const userData = ${JSON.stringify(userData, null, 2)};

     // å­˜å‚¨å½“å‰é€‰ä¸­çš„ç”¨æˆ·ç´¢å¼•
    let currentUserIndex = null;

    // è¾…åŠ©å‡½æ•°ï¼šç”Ÿæˆéšæœºå­—ç¬¦ä¸²
    function generateRandomString(length) {
        const chars = 'abcdefghijklmnopqrstuvwxyz';
        let result = '';
        for (let i = 0; i < length; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
    }

    // è¾…åŠ©å‡½æ•°ï¼šç”Ÿæˆéšæœºç”µè¯å·ç 
    function generateRandomPhone() {
        const prefixes = ['090', '080', '070'];
        const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
        const number = Math.floor(Math.random() * 90000000 + 10000000);
        return prefix + number;
    }

    // è¾…åŠ©å‡½æ•°ï¼šè®¾ç½®è¾“å…¥æ¡†çš„å€¼
    function setInputValue(element, value) {
        if (element) {
            element.value = value;
            element.dispatchEvent(new Event('input', { bubbles: true }));
            element.dispatchEvent(new Event('change', { bubbles: true }));
        }
    }

    // è¾…åŠ©å‡½æ•°ï¼šè®¾ç½®ä¸‹æ‹‰æ¡†çš„å€¼
    function setSelectValue(element, value) {
        if (element) {
            element.value = value;
            element.dispatchEvent(new Event('change', { bubbles: true }));
        }
    }

    // è¾…åŠ©å‡½æ•°ï¼šè®¾ç½®å¤é€‰æ¡†
    function setCheckbox(element, checked) {
        if (element) {
            element.checked = checked;
            element.dispatchEvent(new Event('change', { bubbles: true }));
        }
    }

    // è¾…åŠ©å‡½æ•°ï¼šè®¾ç½®å•é€‰æŒ‰é’®
    function setRadio(value) {
        const radios = document.querySelectorAll('input[type="radio"][name="dwfrm_profile_customer_emailsignup"]');
        radios.forEach(radio => {
            if (radio.value === value) {
                radio.checked = true;
                radio.dispatchEvent(new Event('change', { bubbles: true }));
            }
        });
    }

    // è¾…åŠ©å‡½æ•°ï¼šæ¨¡æ‹ŸæŒ‰é”®
    function simulateKeyPress(element, key) {
        const event = new KeyboardEvent('keydown', {
            key: key,
            code: key,
            bubbles: true,
            cancelable: true
        });
        element.dispatchEvent(event);

        // ä¹Ÿè§¦å‘ keyup äº‹ä»¶
        const keyupEvent = new KeyboardEvent('keyup', {
            key: key,
            code: key,
            bubbles: true,
            cancelable: true
        });
        element.dispatchEvent(keyupEvent);
    }

    // åœ°å€è½¬æ¢å‡½æ•°
    function addressChange(address) {
        const toFullWidthNumber = (num) => num.replace(/[0-9]/g, d => String.fromCharCode(d.charCodeAt(0) + 0xFF10 - 0x30));

        const toKanjiNumber = (num) => {
            const kanjiDigits = ['ã€‡','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'];
            const n = parseInt(num, 10);
            if (isNaN(n)) return num;

            if (n === 0) return 'ã€‡';
            if (n <= 10) {
                if (n === 10) return 'å';
                return kanjiDigits[n];
            }

            if (n >= 11 && n <= 19) {
                return 'å' + kanjiDigits[n - 10];
            }

            if (n >= 20 && n <= 99) {
                const tens = Math.floor(n / 10);
                const ones = n % 10;
                let result = kanjiDigits[tens] + 'å';
                if (ones > 0) {
                    result += kanjiDigits[ones];
                }
                return result;
            }

            return num.split('').map(d => kanjiDigits[parseInt(d)]).join('');
        };

        const [chome, ban, go] = address.split(/[-ãƒ¼âˆ’]/);
        if ([chome, ban, go].includes(undefined)) return address;

        const chomeVariants = [
            chome + "ä¸ç›®",
            toFullWidthNumber(chome) + "ã¡ã‚‡ã†ã‚",
            toFullWidthNumber(chome) + "ãƒãƒ§ã‚¦ãƒ¡",
            toKanjiNumber(chome) + "ä¸ç›®"
        ];

        const banVariants = [
            ban + "ç•ª",
            toFullWidthNumber(ban) + "ã°ã‚“",
            toFullWidthNumber(ban) + "ãƒãƒ³",
            toKanjiNumber(ban) + "ç•ª"
        ];

        const goVariants = [
            go + "å·",
            toFullWidthNumber(go) + "ã”ã†",
            toFullWidthNumber(go) + "ã‚´ã‚¦",
            toKanjiNumber(go) + "å·"
        ];

        while (true) {
            const chomeStr = chomeVariants[Math.floor(Math.random() * chomeVariants.length)];
            const banStr = banVariants[Math.floor(Math.random() * banVariants.length)];
            const goStr = goVariants[Math.floor(Math.random() * goVariants.length)];

            const useDash1 = Math.random() < 0.5;
            const useDash2 = Math.random() < 0.5;

            if (useDash1 && banStr === "ä¸€ç•ª") continue;
            if (useDash2 && goStr === "ä¸€å·") continue;

            let result = chomeStr;
            result += useDash1 ? "-" : "";
            result += banStr;
            result += useDash2 ? "-" : "";
            result += goStr;

            return result;
        }
    }

    // è·å–æ€§åˆ«å¯¹åº”çš„å€¼
    function getGenderValue(gender) {
        const genderMap = {
            'ç”·æ€§': '1',
            'å¥³æ€§': '2',
            'ã©ã¡ã‚‰ã‚‚é¸ã°ãªã„': '9'
        };
        return genderMap[gender] || '9';
    }

    // æ”¹è¿›çš„è·å–ç”¨æˆ·æ•°æ®å‡½æ•°
    function getUserDataFromEmail() {
        // å¦‚æœå·²ç»é€šè¿‡é€‰æ‹©å™¨é€‰æ‹©äº†ç”¨æˆ·ï¼Œç›´æ¥è¿”å›
        if (currentUserIndex !== null && userData[currentUserIndex]) {
            console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] ğŸ“‹ ä½¿ç”¨é€‰æ‹©å™¨é€‰ä¸­çš„ç”¨æˆ·:', userData[currentUserIndex].name);
            return userData[currentUserIndex];
        }

        // å°è¯•å¤šä¸ªå¯èƒ½çš„é‚®ç®±è¾“å…¥æ¡†é€‰æ‹©å™¨
        const emailSelectors = [
            'input[type="email"]',
            'input[name="dwfrm_profile_login_email"]',
            'input[name*="email"]',
            '#registration-form-email'
        ];

        let emailInput = null;
        let emailValue = null;

        // å°è¯•æ‰¾åˆ°é‚®ç®±è¾“å…¥æ¡†
        for (const selector of emailSelectors) {
            emailInput = document.querySelector(selector);
            if (emailInput && emailInput.value) {
                emailValue = emailInput.value.trim();
                break;
            }
        }

        console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] ğŸ“§ å½“å‰é‚®ç®±å€¼:', emailValue || 'æœªæ‰¾åˆ°');

        if (emailValue) {
            const foundUser = userData.find(user => user.email.toLowerCase() === emailValue.toLowerCase());
            if (foundUser) {
                console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… æ‰¾åˆ°åŒ¹é…ç”¨æˆ·:', foundUser.name);
                return foundUser;
            } else {
                console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âš ï¸ æœªæ‰¾åˆ°åŒ¹é…çš„ç”¨æˆ·æ•°æ®');
            }
        }

        // å¦‚æœæ²¡æœ‰æ‰¾åˆ°é‚®ç®±æˆ–åŒ¹é…çš„æ•°æ®ï¼Œè¿”å›ç¬¬ä¸€ä¸ªç”¨æˆ·æ•°æ®ä½œä¸ºé»˜è®¤å€¼
        console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] â„¹ï¸ ä½¿ç”¨é»˜è®¤ç”¨æˆ·æ•°æ®');
        return userData[0];
    }

    // å¡«å……è¡¨å•
    async function autoFillForm() {
        console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] å¼€å§‹è‡ªåŠ¨å¡«å……è¡¨å•');

        // è·å–ç”¨æˆ·æ•°æ®
        const selectedUserData = getUserDataFromEmail();

        if (!selectedUserData) {
            console.error('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âŒ æ— å¯ç”¨çš„ç”¨æˆ·æ•°æ®');
            alert('æœªæ‰¾åˆ°ç”¨æˆ·æ•°æ®ï¼Œè¯·æ£€æŸ¥é‚®ç®±æ˜¯å¦æ­£ç¡®è¾“å…¥');
            return;
        }

        // æ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„æ•°æ®
        console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] ğŸ“‹ ä½¿ç”¨çš„ç”¨æˆ·æ•°æ®:', {
            email: selectedUserData.email,
            name: selectedUserData.name
        });

        try {
            // 1. å¡«å……ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ  (éšæœº5ä¸ªå­—æ¯)
            const nickname = generateRandomString(5);
            const nicknameInput = document.getElementById('registration-form-nname');
            setInputValue(nicknameInput, nickname);
            console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ :', nickname);

            // 2. å¡«å……å§“å
            const nameInput = document.getElementById('registration-form-fname');
            setInputValue(nameInput, selectedUserData.name);
            console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… å§“å:', selectedUserData.name);

            // 3. å¡«å……ãƒ•ãƒªã‚¬ãƒŠ
            const kanaInput = document.getElementById('registration-form-kana');
            setInputValue(kanaInput, selectedUserData.kana);
            console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… ãƒ•ãƒªã‚¬ãƒŠ:', selectedUserData.kana);

            // 4. å¡«å……ç”Ÿå¹´æœˆæ—¥
            const birthday = selectedUserData.birthday;
            const year = birthday.substring(0, 4);
            const month = birthday.substring(4, 6);
            const day = birthday.substring(6, 8);

            const yearSelect = document.getElementById('registration-form-birthdayyear');
            const monthSelect = document.getElementById('registration-form-birthdaymonth');
            const daySelect = document.getElementById('registration-form-birthdayday');

            setSelectValue(yearSelect, year);
            setSelectValue(monthSelect, month);
            setSelectValue(daySelect, day);
            console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… ç”Ÿå¹´æœˆæ—¥:', year, month, day);

            // 5. è®¾ç½®æ€§åˆ«
            const genderSelect = document.querySelector('select[name="dwfrm_profile_customer_gender"]');
            const genderValue = getGenderValue(selectedUserData.gender);
            setSelectValue(genderSelect, genderValue);
            console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… æ€§åˆ¥:', selectedUserData.gender || 'ã©ã¡ã‚‰ã‚‚é¸ã°ãªã„', '(å€¼:', genderValue, ')');

            // 6. å¤„ç†åœ°å€ - ä½¿ç”¨ addressChange è½¬æ¢ myAddress1
            const transformedAddress1 = addressChange(selectedUserData.myAddress1);
            console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] ğŸ“ åœ°å€è½¬æ¢: ', selectedUserData.myAddress1, ' -> ', transformedAddress1);

            // 7. å¡«å……å¯†ç 
            const passwordInput = document.querySelector('input[name="dwfrm_profile_login_password"]');
            const passwordConfirmInput = document.querySelector('input[name="dwfrm_profile_login_passwordconfirm"]');
            setInputValue(passwordInput, selectedUserData.rowpassword);
            setInputValue(passwordConfirmInput, selectedUserData.rowpassword);
            console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:', selectedUserData.rowpassword);

            // 8. å¡«å……é‚®ç®±
            const emailInput = document.querySelector('input[name="dwfrm_profile_login_email"]');
            setInputValue(emailInput, selectedUserData.email);
            console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… é‚®ç®±:', selectedUserData.email);

            // 9. å¡«å……ç”µè¯
            const phoneNumber = selectedUserData.phone || generateRandomPhone();
            const phoneInput = document.querySelector('input[type="tel"]') ||
                              document.querySelector('input[name*="phone"]') ||
                              document.getElementById('registration-form-phone');
            if (phoneInput) {
                setInputValue(phoneInput, phoneNumber);
                console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… ç”µè¯:', phoneNumber, selectedUserData.phone ? '(ä½¿ç”¨æä¾›çš„å·ç )' : '(éšæœºç”Ÿæˆ)');
            }

            // 10. å¡«å……é‚®æ”¿ç¼–ç 
            const postcodeInput = document.getElementById('registration-form-postcode');
            setInputValue(postcodeInput, selectedUserData.postal);
            console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… éƒµä¾¿ç•ªå·:', selectedUserData.postal);

            // 11. å…ˆå¡«å……ç•ªåœ°å’Œå»ºç‰©åï¼ˆç¬¬ä¸€æ¬¡ï¼‰
            const addressInput = document.getElementById('registration-form-address-line1');
            setInputValue(addressInput, transformedAddress1);
            console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… ç•ªåœ°:', transformedAddress1);

            // 12. å¡«å……å»ºç‰©åãƒ»éƒ¨å±‹ç•ªå· (ä½¿ç”¨ myAddress2)
            const buildingInput = document.getElementById('registration-form-address-line2');
            setInputValue(buildingInput, selectedUserData.myAddress2);
            console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… å»ºç‰©åãƒ»éƒ¨å±‹ç•ªå·:', selectedUserData.myAddress2);

            // 13. è®¾ç½®ãƒ¡ãƒ¼ãƒ«ãƒã‚¬ã‚¸ãƒ³ã‚’"å—ã‘å–ã‚‰ãªã„"
            setRadio('false');
            console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… ãƒ¡ãƒ¼ãƒ«ãƒã‚¬ã‚¸ãƒ³: å—ã‘å–ã‚‰ãªã„');

            // 14. å‹¾é€‰åŒæ„æ¡æ¬¾
            const termsCheckbox = document.getElementById('terms');
            const privacyCheckbox = document.getElementById('privacyPolicy');
            setCheckbox(termsCheckbox, true);
            setCheckbox(privacyCheckbox, true);
            console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… åˆ©ç”¨è¦ç´„ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã«åŒæ„');

            // 15. æ»šåŠ¨åˆ°éƒµä¾¿ç•ªå·å¹¶é€‰ä¸­ï¼Œç„¶åæ¨¡æ‹Ÿå³æ–¹å‘é”®
            if (postcodeInput) {
                // å…ˆç­‰å¾…ä¸€ä¸‹è®©é¡µé¢ç¨³å®š
                await new Promise(resolve => setTimeout(resolve, 300));

                // æ»šåŠ¨åˆ°é‚®æ”¿ç¼–ç è¾“å…¥æ¡†
                postcodeInput.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center',
                    inline: 'nearest'
                });

                // ç­‰å¾…æ»šåŠ¨å®Œæˆ
                await new Promise(resolve => setTimeout(resolve, 800));

                // èšç„¦å¹¶é€‰ä¸­
                postcodeInput.focus();
                postcodeInput.select();

                // é«˜äº®æ˜¾ç¤ºï¼ˆä¸´æ—¶ï¼‰
                const originalBorder = postcodeInput.style.border;
                postcodeInput.style.border = '3px solid #ff0000';
                postcodeInput.style.boxShadow = '0 0 10px rgba(255,0,0,0.5)';

                console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… å·²æ»šåŠ¨åˆ°éƒµä¾¿ç•ªå·å¹¶é€‰ä¸­');

                // ç­‰å¾…ä¸€ä¸‹å†æŒ‰å³é”®
                await new Promise(resolve => setTimeout(resolve, 300));

                // æ¨¡æ‹ŸæŒ‰ä¸‹å³æ–¹å‘é”®
                simulateKeyPress(postcodeInput, 'ArrowRight');
                console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… æ¨¡æ‹ŸæŒ‰ä¸‹å³æ–¹å‘é”®');

                // ç­‰å¾…1ç§’
                await new Promise(resolve => setTimeout(resolve, 1000));

                // æ¢å¤åŸå§‹è¾¹æ¡†
                postcodeInput.style.border = originalBorder;
                postcodeInput.style.boxShadow = '';

                // é‡æ–°å¡«å……ç•ªåœ°ï¼ˆå¦‚æœéœ€è¦ï¼‰
                if (addressInput) {
                    setInputValue(addressInput, transformedAddress1);
                    console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… é‡æ–°å¡«å……ç•ªåœ°:', transformedAddress1);
                }
            }

            console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] ğŸ‰ æ‰€æœ‰å­—æ®µå¡«å……å®Œæˆ');

        } catch (error) {
            console.error('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âŒ å¡«å……è¿‡ç¨‹ä¸­å‡ºé”™:', error);
        }
    }

    // åˆ›å»ºç”¨æˆ·é€‰æ‹©å™¨
    function createUserSelector() {
        const selectorContainer = document.createElement('div');
        selectorContainer.style.cssText = `
            position: fixed;
            left: 20px;
            top: 20px;
            z-index: 10000;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        `;

        const label = document.createElement('label');
        label.textContent = 'é€‰æ‹©ç”¨æˆ·ï¼š';
        label.style.cssText = `
            font-size: 14px;
            font-weight: bold;
            margin-right: 10px;
        `;

        const selector = document.createElement('select');
        selector.style.cssText = `
            padding: 5px 10px;
            font-size: 14px;
            border-radius: 5px;
            border: 2px solid #667eea;
            background: white;
            cursor: pointer;
        `;

        // æ·»åŠ é»˜è®¤é€‰é¡¹
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = '-- è‡ªåŠ¨åŒ¹é… --';
        selector.appendChild(defaultOption);

        // æ·»åŠ ç”¨æˆ·é€‰é¡¹
        userData.forEach((user, index) => {
            const option = document.createElement('option');
            option.value = index;
            option.textContent = `${user.name} (${user.email})`;
            selector.appendChild(option);
        });

        // é€‰æ‹©å˜åŒ–æ—¶æ›´æ–°å½“å‰ç”¨æˆ·ç´¢å¼•
        selector.onchange = function() {
            if (this.value === '') {
                currentUserIndex = null;
                console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] ğŸ“‹ åˆ‡æ¢åˆ°è‡ªåŠ¨åŒ¹é…æ¨¡å¼');
            } else {
                currentUserIndex = parseInt(this.value);
                const selectedUser = userData[currentUserIndex];
                console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] ğŸ“‹ æ‰‹åŠ¨é€‰æ‹©ç”¨æˆ·:', selectedUser.name);

                // è‡ªåŠ¨å¡«å……é‚®ç®±
                const emailInput = document.querySelector('input[type="email"]') ||
                                  document.querySelector('input[name="dwfrm_profile_login_email"]');
                if (emailInput) {
                    setInputValue(emailInput, selectedUser.email);
                }
            }
        };

        selectorContainer.appendChild(label);
        selectorContainer.appendChild(selector);
        document.body.appendChild(selectorContainer);
        console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… ç”¨æˆ·é€‰æ‹©å™¨å·²æ·»åŠ ');
    }

    // åˆ›å»ºè‡ªåŠ¨å¡«å……è¡¨å•æŒ‰é’®
    function createFillFormButton() {
        const button = document.createElement('button');
        button.textContent = 'ğŸš€ è‡ªåŠ¨å¡«å……è¡¨å•';
        button.type = 'button';
        button.style.cssText = `
            position: fixed;
            left: 20px;
            top: 45%;
            transform: translateY(-50%);
            z-index: 10000;
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            min-width: 180px;
        `;

        button.onmouseover = () => {
            button.style.transform = 'translateY(-50%) scale(1.05)';
            button.style.boxShadow = '0 6px 20px rgba(0,0,0,0.4)';
        };

        button.onmouseout = () => {
            button.style.transform = 'translateY(-50%) scale(1)';
            button.style.boxShadow = '0 4px 15px rgba(0,0,0,0.3)';
        };

        button.onclick = async () => {
            button.textContent = 'â³ å¡«å……ä¸­...';
            button.disabled = true;

            try {
                await autoFillForm();
                button.textContent = 'âœ… å®Œæˆ';
                button.style.background = 'linear-gradient(135deg, #4caf50 0%, #45a049 100%)';

                setTimeout(() => {
                    button.textContent = 'ğŸš€ è‡ªåŠ¨å¡«å……è¡¨å•';
                    button.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    button.disabled = false;
                }, 2000);
            } catch (error) {
                button.textContent = 'âŒ é”™è¯¯';
                button.style.background = 'linear-gradient(135deg, #f44336 0%, #d32f2f 100%)';

                setTimeout(() => {
                    button.textContent = 'ğŸš€ è‡ªåŠ¨å¡«å……è¡¨å•';
                    button.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    button.disabled = false;
                }, 3000);
            }
        };

        document.body.appendChild(button);
        console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… å¡«è¡¨å•æŒ‰é’®å·²æ·»åŠ ');
    }

    // åˆ›å»ºç¡®è®¤æŒ‰é’®ï¼ˆåŸæ¥çš„å³ä¾§æŒ‰é’®ï¼Œç°åœ¨æ”¾åœ¨å·¦ä¾§ï¼‰
    function createConfirmButton() {
        const confirmButton = document.createElement('button');
        confirmButton.textContent = 'âœ”ï¸ ç¡®è®¤è¿›ã‚€';
        confirmButton.type = 'button';
        confirmButton.style.cssText = `
            position: fixed;
            left: 20px;
            top: 55%;
            transform: translateY(-50%);
            z-index: 10000;
            padding: 15px 30px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            min-width: 180px;
        `;

        confirmButton.onmouseover = () => {
            confirmButton.style.transform = 'translateY(-50%) scale(1.05)';
            confirmButton.style.boxShadow = '0 6px 20px rgba(0,0,0,0.4)';
        };

        confirmButton.onmouseout = () => {
            confirmButton.style.transform = 'translateY(-50%) scale(1)';
            confirmButton.style.boxShadow = '0 4px 15px rgba(0,0,0,0.3)';
        };

        confirmButton.onclick = () => {
            // æŸ¥æ‰¾æäº¤æŒ‰é’®
            const submitButton = document.querySelector('input[type="submit"][value="å…¥åŠ›å†…å®¹ç¢ºèªã¸é€²ã‚€"]') ||
                               document.querySelector('button[type="submit"]') ||
                               document.querySelector('input[type="submit"]') ||
                               document.querySelector('button.submit') ||
                               document.querySelector('.submit-button');

            if (submitButton) {
                submitButton.click();
                console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… å·²æ¨¡æ‹Ÿç‚¹å‡»"å…¥åŠ›å†…å®¹ç¢ºèªã¸é€²ã‚€"æŒ‰é’®');

                const notification = document.createElement('div');
                notification.textContent = 'å·²ç‚¹å‡»ç¡®è®¤æŒ‰é’®ï¼';
                notification.style.cssText = `
                    position: fixed;
                    top: 50px;
                    left: 50%;
                    transform: translateX(-50%);
                    background-color: #4CAF50;
                    color: white;
                    padding: 15px 30px;
                    border-radius: 8px;
                    font-size: 16px;
                    font-weight: bold;
                    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                    z-index: 100000;
                    animation: slideIn 0.3s ease;
                `;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transition = 'opacity 0.5s';
                    setTimeout(() => notification.remove(), 500);
                }, 2000);
            } else {
                alert('æœªæ‰¾åˆ°"å…¥åŠ›å†…å®¹ç¢ºèªã¸é€²ã‚€"æŒ‰é’®');
                console.error('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âŒ æœªæ‰¾åˆ°æäº¤æŒ‰é’®');
            }
        };

        document.body.appendChild(confirmButton);
        console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… ç¡®è®¤æŒ‰é’®å·²æ·»åŠ ');
    }

    // æ·»åŠ åŠ¨ç”»æ ·å¼
    function addAnimationStyles() {
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    top: -100px;
                    opacity: 0;
                }
                to {
                    top: 50px;
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
    }

    // åˆå§‹åŒ–
    function init() {
        setTimeout(() => {
            addAnimationStyles();
            createUserSelector();
            createFillFormButton();
            createConfirmButton();  // åˆ›å»ºç¡®è®¤æŒ‰é’®
        }, 1000);
    }

    // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œ
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

    console.log('[ä¼šå‘˜æ³¨å†ŒåŠ©æ‰‹] âœ… è„šæœ¬åŠ è½½å®Œæˆ (å®Œæ•´å¢å¼ºç‰ˆ v3.6)');

})();
`;

            return scriptTemplate;
        }

        function copyToClipboard() {
            const text = document.getElementById('userDataDisplay').innerText;
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert('æ²¹çŒ´è„šæœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿!');
        }

        document.getElementById('file-input').addEventListener('change', handleFile);
    </script>

</body>
</html>
